<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no" />
    <link rel="stylesheet"  href="{{asset('assets/css/swiper-3.3.1.min.css')}}" />
    <link rel="stylesheet"  href="{{asset('assets/mobile/css/index.css')}}" />
    <link rel="stylesheet"  href="{{asset('assets/css/zan.css')}}" />
    <link rel="stylesheet"  href="{{asset('assets/alert/sweetalert.css')}}" />
    <script language="JavaScript" src="{{asset('assets/js/jquery-1.8.2.min.js')}}"></script>
    <script language="JavaScript" src="{{asset('assets/js/swiper-3.3.1.jquery.min.js')}}"></script>
    <script language="JavaScript" src="{{asset('assets/js/jquery.lazyload.min.js')}}"></script>
    <script language="JavaScript" src="{{asset('assets/js/jquery.superslide.2.1.1.js')}}"></script>
    <script language="JavaScript" src="{{asset('assets/alert/sweetalert.min.js')}}"></script>
    <script language="JavaScript" src="{{asset('assets/ckplayer/ckplayer.js')}}" charset="utf-8"></script>
    <script language="JavaScript" src="{{asset('assets/des/rollups/tripledes.js')}}" charset="utf-8"></script>
    <script language="JavaScript" src="{{asset('assets/des/components/mode-ecb-min.js')}}" charset="utf-8"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        <?php $app = app('wechat.official_account'); ?>
        wx.config(<?php echo $app->jssdk->buildConfig(array('onMenuShareTimeline', 'onMenuShareAppMessage'), false) ?>);
        wx.ready(function () {
            wx.onMenuShareTimeline({
                title: 'HYDROGEN学院',
                imgUrl: 'http://boser1u.top{{$video->thumb}}',
                success: function () {
                    alert("已分享到朋友圈");
                },
                cancel: function () {
                    alert("取消分享到朋友圈");
                }
            });
            //分享给朋友
            wx.onMenuShareAppMessage({
                title: 'HYDROGEN学院',
                imgUrl: 'http://boser1u.top{{$video->thumb}}',
                success: function () {
                    alert("已分享给好友");
                },
                cancel: function () {
                    alert("取消分享给好友");
                }
            });
        });
    </script>
    <title>HYDROGEN学院</title>
    <script>
        var username = "{{$username}}";
        var userid = "{{$userid}}";
    </script>
    <script language="JavaScript" src="{{asset('assets/js/zan_m.js')}}" charset="utf-8"></script>
</head>

<body>
<input type="hidden" id="_token" name="_token" value="{{csrf_token()}}">
<div class="head_box">
    <div class="head_block">
        {{$video->description}}
    </div>
    <input style="position: absolute;top: 5px;right: 5px;" type="button" class="btn btn_icon2
     @if(!empty($is_like))
        @if($is_like->del_flg == 'N')
        {{'btn_icon2_sele'}}
        @endif
        @endif" data-classid="{{$video->id}}"  id="like" onclick="like(this, 'like')"/>
        <input  style="position: absolute;top: 5px;right: 45px;" type="button" class="btn btn_icon3
        @if(!empty($is_collect))
        @if($is_collect->del_flg == 'N')
        {{'btn_icon3_sele'}}
        @endif
    @endif" data-classid="{{$video->id}}"  id="collect" onclick="collect(this, 'collect')"/>
    <a class="back" href="javascript:void(0);"></a>

</div>
<div class="pic_box">
    <div id='a1'>

    </div>
</div>
<script type="text/javascript">
    var videoObject = {
            container: '#a1', //“#”代表容器的ID，“.”或“”代表容器的class
            variable: 'player', //该属性必需设置，值等于下面的new chplayer()的对象
            @if($video->is_admin)
            loaded: 'loadedHandler',
            @endif
            poster: '{{$video->thumb}}',
            video: "{{env('PLAY_URL')}}"+'{{$video->id}}' //视频地址
        };
    var player = new ckplayer(videoObject);
    //只有vip视频时才判断弹窗X
   @if($video->is_admin)
    var elementLogin = null; //是否存在提示层
    var vipOrNO = '{{$vipOrNO}}'; //是否已登录，默认是没有登录
    var loginShow = false; //提示层是否是显示状态
    function loadedHandler() { //播放器加载后会调用该函数
        player.addListener('time', timeHandler); //监听播放时间,addListener是监听函数，需要传递二个参数，'time'是监听属性，这里是监听时间，timeHandler是监听接受的函数
        player.addListener('play', playHandler); //监听播放状态
        player.addListener('full', fullHandler); //监听全屏切换
    }

    function playHandler() { //监听播放状态
        if(loginShow) {
            player.videoPause();
            showLogin();
        }
    }

    function fullHandler(b) { //监听全屏切换
        if(loginShow && elementLogin) {
            player.deleteElement(elementLogin);
            elementLogin = null;
            window.setTimeout('showLogin()', 200);
        }
    }

    function timeHandler(t) { //监听播放时间
        if(t >= '{{(config('hydrogen.look_time'))}}' && vipOrNO!=1) { //如果播放时间大于1，则又没有登录，则弹出登录/注册层
            player.videoPause();
            player.videoSeek(0);
            if(!loginShow && !elementLogin) {
                showLogin();
            }
        }
    }

    function showLogin() {
        loginShow = true;
//                    elementLogin = player.addElement(attribute);
        swal(
            {
                title:"",
                text:"试看结束,此视频为vip尊享,点击确定去开通会员",
                showCancelButton:true,
                confirmButtonColor:"#DD6B55",
                confirmButtonText:"确定",
                cancelButtonText:"取消",
                closeOnConfirm:true,
                closeOnCancel:true
            },
            function(isConfirm)
            {
                if(isConfirm)
                {
                    window.location="http://boser1u.top/pay"
                }
            }
        )


    }


    function loginTrue() { //附加的处理用户登录后执行的动作
        vipOrNO = '1';
        if(loginShow && elementLogin) {
            player.deleteElement(elementLogin);
            elementLogin = null;
            loginShow = false;
            player.videoPlay();
        }
    }
    @endif
</script>
<div class="sml_nav_box">
    <a class="sele" href="javascript:void(0)">评论</a>
</div>

<div class="dialogue_bg">
    <div class="dialogue_box">
        @foreach($video_comment as $k => $vc)
            <span style="color:blue">{{$vc->username}}</span><span style="color:blue">：</span>{{$vc->comment}}<br>
        @endforeach
    </div>

</div>

<div class="send_box">
    <input class="send_txt" type="text" id='send'>
    <input class="send_btn" type="button" value="发送" id="sendBtn">
</div>
 <script>
    $(document).ready(function () {
        //菜单选择
        $('.sml_nav_box a').click(function () {
            $('.sml_nav_box a').removeClass("sele");
            $(this).addClass("sele");
        });
        $('.dialogue_box').height($(window).height()-$('.head_box').height()-$('.pic_box').height()-$('.sml_nav_box').height()-$('.send_box').height()-30);
    });
    var domain = window.location.hostname
    $('#sendBtn').click(function(){
        {{--username = "{{$username}}";--}}
        {{--userid = "{{$userid}}";--}}
        var video_id = "{{$video->id}}";
        if (userid == "" || username == "") {
            alert('请您登录后发表评论');
            window.location.href= 'http://'+domain+'/mobile/login';
        }
        var url = '/video/add-comment';
        var comment = $.trim($('#send').val());
        if(!comment){
            // alert('请输入内容！');
            return false;
        }
        if (comment.length > 30) {
            alert("内容太长，最多 30个文字");
            return false;
        }
        var data = {
            '_token': "{!! csrf_token() !!}",
            'userid' : userid,
            'username' : username,
            'video_id' : video_id,
            'comment'  : comment,
        }
        $.post(url, data, function(msg){
            if(msg.result == 'OK'){
                var str='<span style="color:blue">{{$username}}</span><span style="color:blue">：</span>'+comment+'<br>';
                $(".dialogue_box").append(str);
                $('.dialogue_box').scrollTop( $('.dialogue_box')[0].scrollHeight );
                $('#send').val('');
            }else{
                alert(msg.error);
                $('#send').val('');
            }

        },'json');
    });

    $(".back").click(function(){
        if(history.length > 2){
            window.history.go( -1 );
        }else{
            window.location.href= 'http://'+domain+'/mobile/index';
        }
    });
</script>
</body>